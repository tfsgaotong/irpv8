<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="IRP_WORKFLOW_OBJ">
  <resultMap class="com.tfs.irp.workflow.entity.IrpWorkflowObj" id="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    <result column="FLOWOBJID" jdbcType="DECIMAL" property="flowobjid" />
    <result column="FLOWID" jdbcType="DECIMAL" property="flowid" />
    <result column="NODEID" jdbcType="DECIMAL" property="nodeid" />
    <result column="STATUS" jdbcType="DECIMAL" property="status" />
    <result column="POSTUSERID" jdbcType="DECIMAL" property="postuserid" />
    <result column="POSTTIME" jdbcType="TIMESTAMP" property="posttime" />
    <result column="POSTDESC" jdbcType="VARCHAR" property="postdesc" />
    <result column="PRENODEID" jdbcType="DECIMAL" property="prenodeid" />
    <result column="OBJID" jdbcType="DECIMAL" property="objid" />
    <result column="OBJTYPE" jdbcType="VARCHAR" property="objtype" />
    <result column="CRUSERID" jdbcType="DECIMAL" property="cruserid" />
    <result column="CRUSER" jdbcType="VARCHAR" property="cruser" />
    <result column="CRTIME" jdbcType="TIMESTAMP" property="crtime" />
    <result column="TRANSFERTYPE" jdbcType="DECIMAL" property="transfertype" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObjExample" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    select FLOWOBJID, FLOWID, NODEID, STATUS, POSTUSERID, POSTTIME, POSTDESC, PRENODEID, OBJID,
      OBJTYPE, CRUSERID, CRUSER, CRTIME, TRANSFERTYPE
    from IRP_WORKFLOW_OBJ
    <isParameterPresent>
      <include refid="IRP_WORKFLOW_OBJ.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObj" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    select FLOWOBJID, FLOWID, NODEID, STATUS, POSTUSERID, POSTTIME, POSTDESC, PRENODEID, OBJID,
      OBJTYPE, CRUSERID, CRUSER, CRTIME, TRANSFERTYPE
    from IRP_WORKFLOW_OBJ
    where FLOWOBJID = #flowobjid:DECIMAL#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObj">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    delete from IRP_WORKFLOW_OBJ
    where FLOWOBJID = #flowobjid:DECIMAL#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObjExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    delete from IRP_WORKFLOW_OBJ
    <include refid="IRP_WORKFLOW_OBJ.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObj">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    insert into IRP_WORKFLOW_OBJ (FLOWOBJID, FLOWID, NODEID, STATUS, POSTUSERID, POSTTIME, POSTDESC,
      PRENODEID, OBJID, OBJTYPE, CRUSERID, CRUSER, CRTIME, TRANSFERTYPE)
    values (#flowobjid:DECIMAL#, #flowid:DECIMAL#, #nodeid:DECIMAL#, #status:DECIMAL#,
      #postuserid:DECIMAL#, #posttime:TIMESTAMP#, #postdesc:VARCHAR#, #prenodeid:DECIMAL#,
      #objid:DECIMAL#, #objtype:VARCHAR#, #cruserid:DECIMAL#, #cruser:VARCHAR#, #crtime:TIMESTAMP#,
      #transfertype:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObj">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    insert into IRP_WORKFLOW_OBJ
    <dynamic prepend="(">
      <isNotNull prepend="," property="flowobjid">
        FLOWOBJID
      </isNotNull>
      <isNotNull prepend="," property="flowid">
        FLOWID
      </isNotNull>
      <isNotNull prepend="," property="nodeid">
        NODEID
      </isNotNull>
      <isNotNull prepend="," property="status">
        STATUS
      </isNotNull>
      <isNotNull prepend="," property="postuserid">
        POSTUSERID
      </isNotNull>
      <isNotNull prepend="," property="posttime">
        POSTTIME
      </isNotNull>
      <isNotNull prepend="," property="postdesc">
        POSTDESC
      </isNotNull>
      <isNotNull prepend="," property="prenodeid">
        PRENODEID
      </isNotNull>
      <isNotNull prepend="," property="objid">
        OBJID
      </isNotNull>
      <isNotNull prepend="," property="objtype">
        OBJTYPE
      </isNotNull>
      <isNotNull prepend="," property="cruserid">
        CRUSERID
      </isNotNull>
      <isNotNull prepend="," property="cruser">
        CRUSER
      </isNotNull>
      <isNotNull prepend="," property="crtime">
        CRTIME
      </isNotNull>
      <isNotNull prepend="," property="transfertype">
        TRANSFERTYPE
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="flowobjid">
        #flowobjid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="flowid">
        #flowid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="nodeid">
        #nodeid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="status">
        #status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="postuserid">
        #postuserid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="posttime">
        #posttime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="postdesc">
        #postdesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="prenodeid">
        #prenodeid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="objid">
        #objid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="objtype">
        #objtype:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="cruserid">
        #cruserid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="cruser">
        #cruser:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="crtime">
        #crtime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="transfertype">
        #transfertype:DECIMAL#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObjExample" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    select count(*) from IRP_WORKFLOW_OBJ
    <include refid="IRP_WORKFLOW_OBJ.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    update IRP_WORKFLOW_OBJ
    <dynamic prepend="set">
      <isNotNull prepend="," property="record.flowobjid">
        FLOWOBJID = #record.flowobjid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.flowid">
        FLOWID = #record.flowid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.nodeid">
        NODEID = #record.nodeid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.status">
        STATUS = #record.status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.postuserid">
        POSTUSERID = #record.postuserid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.posttime">
        POSTTIME = #record.posttime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.postdesc">
        POSTDESC = #record.postdesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.prenodeid">
        PRENODEID = #record.prenodeid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.objid">
        OBJID = #record.objid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.objtype">
        OBJTYPE = #record.objtype:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.cruserid">
        CRUSERID = #record.cruserid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.cruser">
        CRUSER = #record.cruser:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.crtime">
        CRTIME = #record.crtime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.transfertype">
        TRANSFERTYPE = #record.transfertype:DECIMAL#
      </isNotNull>
    </dynamic>
    <isParameterPresent>
      <include refid="IRP_WORKFLOW_OBJ.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    update IRP_WORKFLOW_OBJ
    set FLOWOBJID = #record.flowobjid:DECIMAL#,
      FLOWID = #record.flowid:DECIMAL#,
      NODEID = #record.nodeid:DECIMAL#,
      STATUS = #record.status:DECIMAL#,
      POSTUSERID = #record.postuserid:DECIMAL#,
      POSTTIME = #record.posttime:TIMESTAMP#,
      POSTDESC = #record.postdesc:VARCHAR#,
      PRENODEID = #record.prenodeid:DECIMAL#,
      OBJID = #record.objid:DECIMAL#,
      OBJTYPE = #record.objtype:VARCHAR#,
      CRUSERID = #record.cruserid:DECIMAL#,
      CRUSER = #record.cruser:VARCHAR#,
      CRTIME = #record.crtime:TIMESTAMP#,
      TRANSFERTYPE = #record.transfertype:DECIMAL#
    <isParameterPresent>
      <include refid="IRP_WORKFLOW_OBJ.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObj">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    update IRP_WORKFLOW_OBJ
    <dynamic prepend="set">
      <isNotNull prepend="," property="flowid">
        FLOWID = #flowid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="nodeid">
        NODEID = #nodeid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="status">
        STATUS = #status:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="postuserid">
        POSTUSERID = #postuserid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="posttime">
        POSTTIME = #posttime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="postdesc">
        POSTDESC = #postdesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="prenodeid">
        PRENODEID = #prenodeid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="objid">
        OBJID = #objid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="objtype">
        OBJTYPE = #objtype:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="cruserid">
        CRUSERID = #cruserid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="cruser">
        CRUSER = #cruser:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="crtime">
        CRTIME = #crtime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="transfertype">
        TRANSFERTYPE = #transfertype:DECIMAL#
      </isNotNull>
    </dynamic>
    where FLOWOBJID = #flowobjid:DECIMAL#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.tfs.irp.workflow.entity.IrpWorkflowObj">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 16 20:08:32 CST 2013.
    -->
    update IRP_WORKFLOW_OBJ
    set FLOWID = #flowid:DECIMAL#,
      NODEID = #nodeid:DECIMAL#,
      STATUS = #status:DECIMAL#,
      POSTUSERID = #postuserid:DECIMAL#,
      POSTTIME = #posttime:TIMESTAMP#,
      POSTDESC = #postdesc:VARCHAR#,
      PRENODEID = #prenodeid:DECIMAL#,
      OBJID = #objid:DECIMAL#,
      OBJTYPE = #objtype:VARCHAR#,
      CRUSERID = #cruserid:DECIMAL#,
      CRUSER = #cruser:VARCHAR#,
      CRTIME = #crtime:TIMESTAMP#,
      TRANSFERTYPE = #transfertype:DECIMAL#
    where FLOWOBJID = #flowobjid:DECIMAL#
  </update>
  <select id="selectWorkFlowObjByUserId" parameterClass="java.lang.Long" resultClass="java.util.HashMap">
  	SELECT obj1.FLOWOBJID, obj1.FLOWID, obj1.NODEID, obj1.STATUS, obj2.POSTUSERID, obj2.POSTTIME, obj2.POSTDESC, obj1.OBJID, doc.doctitle, obj1.OBJTYPE, obj1.CRUSERID, obj1.CRUSER, obj1.CRTIME 
	FROM IRP_WORKFLOW_OBJ obj1 left join IRP_WORKFLOW_OBJ obj2 on (obj1.PRENODEID=obj2.FLOWOBJID) 
	  left join IRP_DOCUMENT doc on(obj1.objtype='IRP_DOCUMENT' and obj1.objid=doc.docid)
	where (obj1.status=2 and obj1.postuserid=#userId:DECIMAL#) or
		  (obj1.status=1 and exists(
		    select 1 from irp_workflow_employ where irp_workflow_employ.flownodeid=obj1.nodeid 
		      and (
		            (irp_workflow_employ.employobjtype='IRP_USER' and irp_workflow_employ.employobjid=#userId:DECIMAL#) 
		            or (irp_workflow_employ.employobjtype='IRP_GROUP' and exists(
		              select 1 from irp_usergroup_link where irp_workflow_employ.employobjid=irp_usergroup_link.groupid and irp_usergroup_link.userid=#userId:DECIMAL#
		            ))
	      )
	  ))
	order by obj1.crtime desc
  </select>
  
  <select id="selectWorkFlowObjCountByUserId" parameterClass="java.lang.Long" resultClass="java.lang.Integer">
  	SELECT count(1)
	FROM IRP_WORKFLOW_OBJ
	where objtype='IRP_DOCUMENT' 
		and (
		  (status=2 and postuserid=#userId:DECIMAL#) or
		  (status=1 and exists(
		    select 1 from irp_workflow_employ where irp_workflow_employ.flownodeid=IRP_WORKFLOW_OBJ.nodeid 
		      and (
		            (irp_workflow_employ.employobjtype='IRP_USER' and irp_workflow_employ.employobjid=#userId:DECIMAL#) 
		            or (irp_workflow_employ.employobjtype='IRP_GROUP' and exists(
		              select 1 from irp_usergroup_link where irp_workflow_employ.employobjid=irp_usergroup_link.groupid and irp_usergroup_link.userid=#userId:DECIMAL#
		            ))
		      )
		  ))
		)
  </select>
  <select id="selectNotSignFlowCountByUserId" parameterClass="java.lang.Long" resultClass="java.lang.Integer">
  	SELECT count(1)
		FROM IRP_WORKFLOW_OBJ
	where objtype='IRP_DOCUMENT' 
		and status=1
		and exists(
			select 1 from irp_workflow_employ where irp_workflow_employ.flownodeid=IRP_WORKFLOW_OBJ.nodeid 
		      and (
		            (irp_workflow_employ.employobjtype='IRP_USER' and irp_workflow_employ.employobjid=#userId:DECIMAL#) 
		            or (irp_workflow_employ.employobjtype='IRP_GROUP' and exists(
		              select 1 from irp_usergroup_link where irp_workflow_employ.employobjid=irp_usergroup_link.groupid and irp_usergroup_link.userid=#userId:DECIMAL#
		            ))
		      )
		)
  </select>
</sqlMap>